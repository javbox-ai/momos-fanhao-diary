<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ä½¿ç”¨ AI ç”Ÿæˆçš„ SEO æ‘˜è¦ä½œç‚º description -->
    <meta name="description" content="{{ seo_summary if seo_summary else (video.title if video else '') }}">
    <title>{{ video.title if video else ('Video Detail' if lang == 'en' else 'å½±ç‰‡è©³æƒ…') }} - {{ 'AV Review Sharing' if lang == 'en' else 'AVå¿ƒå¾—åˆ†äº«' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="logo">
                <a href="{{ url_for('index', lang=lang) }}">
                    <img src="{{ url_for('static', filename='LOGO.png') }}" alt="Momoâ€™s Fanhao Diary Logo" style="height: 50px;"> <!-- Adjust height as needed -->
                </a>
            </div>
        <nav class="main-nav">
            <form action="{{ url_for('search_redirect') }}" method="get">
                <input type="hidden" name="lang" value="{{ lang }}">
                <input type="text" name="q" placeholder="{{ 'Enter number or actress name' if lang == 'en' else 'è¼¸å…¥ç•ªè™Ÿæˆ–å¥³å„ªå' }}">
                <button type="submit">{{ 'Search' if lang == 'en' else 'æœå°‹' }}</button>
            </form>
        </nav>
        <div class="language-switcher">
            {% set current_video_id = video.id if video else None %}
            <a href="{{ url_for(request.endpoint, video_id=current_video_id, lang='zh', **request.view_args) if current_video_id else url_for('index', lang='zh') }}" class="{% if lang == 'zh' %}active{% endif %}">ä¸­æ–‡</a> | 
            <a href="{{ url_for(request.endpoint, video_id=current_video_id, lang='en', **request.view_args) if current_video_id else url_for('index', lang='en') }}" class="{% if lang == 'en' %}active{% endif %}">English</a>
        </div>
    </header>

    <main>
        {% if video %}
        <article class="video-detail">
            <h1>{{ video.title }} {% if seo_summary %}<span class="seo-summary">{{ seo_summary }}</span>{% endif %}</h1>
            <img src="{{ video.cover_image if video.cover_image else url_for('static', filename='placeholder.jpg') }}" alt="{{ video.title }}" class="cover-image" style="max-width: 100%; height: auto;">

            <section class="ai-intro">
                <h2>{{ 'AI Introduction' if lang == 'en' else 'AIä»‹ç´¹æ–‡æ®µè½' }}</h2>
                <p>{{ ai_intro | safe }}</p>
            </section>

            <section class="ai-review">
                <h2>{{ 'AI Review' if lang == 'en' else 'AIå¿ƒå¾—æ®µè½' }}</h2>
                <p>{{ ai_review | safe }}</p>
            </section>

            <section class="ads-content-top">
                <h3>{{ 'Ad Space (Top)' if lang == 'en' else 'å»£å‘Šä½ (é é¦–/å…§å®¹å‰)' }}</h3>
                <p>{{ 'Advertisement' if lang == 'en' else 'å»£å‘Š' }}</p>
            </section>

            <!-- å¯åœ¨æ­¤è™•åŠ å…¥å¾ video ç‰©ä»¶è®€å–çš„å…¶ä»–è©³ç´°è³‡è¨Š -->
            <div class="video-meta">
                {% if video.actress %}
                <span>{{ 'Actress' if lang == 'en' else 'å¥³å„ª' }}: {{ video.actress }}</span><br>
                {% endif %}
                {% if video.release_date %}
                <span>{{ 'Release Date' if lang == 'en' else 'ç™¼è¡Œæ—¥æœŸ' }}: {{ video.release_date.strftime('%Y-%m-%d') if video.release_date else 'N/A' }}</span><br>
                {% endif %}
                {% if video.category %}
                <span>{{ 'Category' if lang == 'en' else 'é¡åˆ¥' }}: <a href="{{ url_for('category', category_name=video.category, lang=lang) }}">{{ video.category }}</a></span><br>
                {% endif %}
                {% if video.duration %}
                <span>{{ 'Duration' if lang == 'en' else 'ç‰‡é•·' }}: {{ video.duration }} {{ 'min' if lang == 'en' else 'åˆ†é˜' }}</span><br>
                {% endif %}
                {% if video.tags %} 
                <section class="tags">
                    <h3>{{ 'Tags' if lang == 'en' else 'æ¨™ç±¤' }}</h3>
                    {% for tag in video.tags.split(',') %}
                    <span>{{ tag.strip() }}</span>
                    {% endfor %}
                </section>
                {% endif %}
            </div>

            <section class="ads-content-middle">
                <h3>{{ 'Ad Space (Middle)' if lang == 'en' else 'å»£å‘Šä½ (å…§å®¹ä¸­)' }}</h3>
                <p>{{ 'Advertisement' if lang == 'en' else 'å»£å‘Š' }}</p>
            </section>

            <aside class="floating-nav">
                <h3>{{ 'Extended Search' if lang == 'en' else 'å»¶ä¼¸æœå°‹æ¬„' }}</h3>
                <p>{{ '(Consider placing on the right or floating bar)' if lang == 'en' else '(å¯è€ƒæ…®æ”¾ç½®åœ¨å³é‚Šæˆ–æµ®å‹•æ¢ä¸Š)' }}</p>
                <!-- æœå°‹æ¬„ä½ -->
            </aside>

            <button class="favorite-button" onclick="toggleFavorite('{{ video.id }}')">â™¥ {{ 'Favorite this post' if lang == 'en' else 'æ”¶è—é€™ä¸€ç¯‡' }}</button>

            <section class="ads-content-bottom">
                <h3>{{ 'Ad Space (Bottom)' if lang == 'en' else 'å»£å‘Šä½ (é å°¾/å…§å®¹å¾Œ)' }}</h3>
                <p>{{ 'Advertisement' if lang == 'en' else 'å»£å‘Š' }}</p>
            </section>

            <section class="momo-whisper">
                <h2>{{ "Momo's Whispers" if lang == 'en' else "Momo çš„æ‚„æ‚„è©±" }}</h2>
                <p>{{ "This scene is really something! Makes you think... ğŸ˜‰" if lang == 'en' else "é€™å€‹ç•«é¢çœŸçš„æœ‰é»æ±è¥¿ï¼è®“äººçœ‹äº†éƒ½... ğŸ˜‰" }}</p>
                {# TODO: Add more dynamic whispers later #}
            </section>

            <section class="recommendations">
                <h2>{{ 'Recommendations (Optional)' if lang == 'en' else 'å»¶ä¼¸æ¨è–¦ (optional)' }}</h2>
                <p>{{ 'Based on category tags or actress.' if lang == 'en' else 'ä»¥åˆ†é¡æ¨™ç±¤æˆ–å¥³å„ªç‚ºä¸»ï¼Œåƒ Netflix ä¸€æ¨£æ‹‰æ»‘æ¢æ¨è–¦é¡ä¼¼ä½œå“' }}</p>
                <!-- æ¨è–¦å¡ç‰‡ -->
            </section>
        </article>
        {% else %}
        <div class="error-message">
            <h1>{{ 'Error' if lang == 'en' else 'éŒ¯èª¤' }}</h1>
            <p>{{ 'Video not found.' if lang == 'en' else 'æ‰¾ä¸åˆ°æŒ‡å®šçš„å½±ç‰‡ã€‚' }}</p>
            <a href="{{ url_for('index', lang=lang) }}">{{ 'Back to Home' if lang == 'en' else 'è¿”å›é¦–é ' }}</a>
        </div>
        {% endif %}
        <section class="download-section">
            <h3>{{ 'Download / Search' if lang == 'en' else 'ä¸‹è¼‰ / æœå°‹è³‡æº' }}</h3>
            <!-- Construct the URL for the go page, passing the video ID (assuming video.id is the number) -->
            <a href="{{ url_for('go_redirect', query=video.id, lang=lang) }}" class="download-button" target="_blank">
                {{ 'Find Resources on AVHub' if lang == 'en' else 'å‰å¾€ AVHub æœå°‹è³‡æº' }}
            </a>
            <p class="disclaimer">{{ '(Opens ad page first)' if lang == 'en' else '(å°‡å…ˆé–‹å•Ÿå»£å‘Šé é¢)' }}</p>
        </section>
    </main>

    <footer>
        <section class="ads-footer">
            <h3>{{ 'Ad Space (Footer)' if lang == 'en' else 'å»£å‘Šä½ (é å°¾)' }}</h3>
            <p>{{ 'Advertisement' if lang == 'en' else 'å»£å‘Š' }}</p>
        </section>
        <p>&copy; 2024 {{ 'AV Review Sharing' if lang == 'en' else 'AVå¿ƒå¾—åˆ†äº«' }}</p>
    </footer>

    <script>
        function toggleFavorite(videoId) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
            const button = document.querySelector('.favorite-button');
            if (favorites[videoId]) {
                delete favorites[videoId];
                button.classList.remove('favorited');
                button.innerHTML = `â™¥ {{ 'Favorite this post' if lang == 'en' else 'æ”¶è—é€™ä¸€ç¯‡' }}`;
                console.log(`Removed ${videoId} from favorites`);
            } else {
                favorites[videoId] = true;
                button.classList.add('favorited');
                button.innerHTML = `â˜… {{ 'Favorited' if lang == 'en' else 'å·²æ”¶è—' }}`;
                console.log(`Added ${videoId} to favorites`);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // Set initial button state on page load
        document.addEventListener('DOMContentLoaded', () => {
            const videoId = '{{ video.id if video else None }}';
            if (videoId) {
                const favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
                const button = document.querySelector('.favorite-button');
                if (favorites[videoId]) {
                    button.classList.add('favorited');
                    button.innerHTML = `â˜… {{ 'Favorited' if lang == 'en' else 'å·²æ”¶è—' }}`;
                }
            }
        });
    </script>
</body>
</html>